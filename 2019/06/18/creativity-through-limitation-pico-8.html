<!DOCTYPE html>
<html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-104711057-2"></script>
	<script>
  	window.dataLayer = window.dataLayer || [];
  	function gtag(){dataLayer.push(arguments);}
  	gtag('js', new Date());
  	gtag('config', 'UA-104711057-2');
	</script><meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/assets/favicon-96x96.png">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:600|PT+Serif|Source+Code+Pro&display=swap" rel="stylesheet"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Creativity through limitation: PICO-8 — Fantasy Console | Megus</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Creativity through limitation: PICO-8 — Fantasy Console" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When was the last time you coded something just for fun? PICO-8 brings fun back to programming!" />
<meta property="og:description" content="When was the last time you coded something just for fun? PICO-8 brings fun back to programming!" />
<link rel="canonical" href="https://megus.org/2019/06/18/creativity-through-limitation-pico-8.html" />
<meta property="og:url" content="https://megus.org/2019/06/18/creativity-through-limitation-pico-8.html" />
<meta property="og:site_name" content="Megus" />
<meta property="og:image" content="https://megus.org/assets/blog-images/2019-06-18-cover.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-18T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@sugem" />
<meta name="twitter:creator" content="@sugem" />
<script type="application/ld+json">
{"url":"https://megus.org/2019/06/18/creativity-through-limitation-pico-8.html","headline":"Creativity through limitation: PICO-8 — Fantasy Console","dateModified":"2019-06-18T00:00:00+03:00","datePublished":"2019-06-18T00:00:00+03:00","image":"https://megus.org/assets/blog-images/2019-06-18-cover.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://megus.org/2019/06/18/creativity-through-limitation-pico-8.html"},"description":"When was the last time you coded something just for fun? PICO-8 brings fun back to programming!","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://megus.org/feed.xml" title="Megus" /></head>
<body><header class="site-header" role="banner">
  <div class="site-header-wrapper"><a href="/"><img class="site-logo" src="/assets/megus.png" />
    <span class="site-title" rel="author">Megus</span></a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/portfolio.html">Portfolio</a><a class="page-link" href="/music.html">Music</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.3&appId=194003690636360&autoLogAppEvents=1"></script>
<script>window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);
  
    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };
  
    return t;
  }(document, "script", "twitter-wjs"));</script>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header"><div class="post-cover" style="background-image: url(/assets/blog-images/2019-06-18-cover.jpg)">
        <div class="gradient">
          <img hidden itemprop="image" src="/assets/blog-images/2019-06-18-cover.jpg" />
          <h1 class="post-cover-title p-name" itemprop="name headline">Creativity through limitation: PICO-8 — Fantasy Console</h1>
        </div>
      </div><p class="post-meta">
      <time class="dt-published" datetime="2019-06-18T00:00:00+03:00" itemprop="datePublished">Jun 18, 2019
      </time>
    </p>
    <span hidden itemscope itemtype="http://schema.org/Person" itemprop="author">
      <span hidden itemprop="name">Roman "Megus" Petrov</span>
    </span>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>It is the second article in “Creativity through limitation” series. Check out the first one: <a href="/2018/08/05/creativity-through-limitation-8-bit-demoscene.html">8-bit demoscene</a>. In this article, I’m going to tell you about the fantasy console PICO-8 and recreate two classic demoscene effects with it.</p>

<p>When was the last time you coded something just for fun? If you’re like me, then it hasn’t happened for years. However, about a year ago, I learned about PICO-8, bought it, and I have to say that these were probably the most worthy $15 I spent on myself last year!</p>

<h2 id="what-is-pico-8">What is PICO-8?</h2>

<blockquote>
  <p>PICO-8 is a fantasy console for making, sharing and playing tiny games and other computer programs. When you turn it on, the machine greets you with a command line and simple built-in tools for creating your own cartridges and exploring the PICO-8 cartverse. — <a href="https://www.lexaloffle.com/pico-8.php">PICO-8 official page</a></p>
</blockquote>

<p>Do you remember the era of 8-bit video game consoles and computers? PICO-8 returns you to those times. It is an “emulator” of a non-existing video game console with Lua “CPU” developed by <a href="https://www.lexaloffle.com">Lexaloffle</a>. It has a set of wisely designed constraints (speed, color palette, screen resolution, sound, and memory) which may look ridiculous, but it stimulates your creative muscle. Also, to let you start creating right away, PICO-8 gives you simple but convenient built-in tools: code, graphics, and sound/music editors.</p>

<p><img src="/assets/blog-images/2019-06-18-pico-8-tools.png" alt="PICO-8 Built-in tools" /></p>

<p>PICO-8 has a fantastic community. Many people create games, demos, and tutorials. Teachers use it at schools to teach children programming. Professional game developers use it for experiments. One thing unites them all — it’s fun!</p>

<p>There’s also a pretty unique creative genre on PICO-8 — Tweetcart. Tweetcart is a program that fits in a Tweet (up to 280 characters) and produces some impressive visual effect. The idea is very similar to demoscene intro.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Tree with Moon // 278 chars -- <a href="https://twitter.com/hashtag/pico8?src=hash&amp;ref_src=twsrc%5Etfw">#pico8</a> src in reply<a href="https://twitter.com/hashtag/tweetcart?src=hash&amp;ref_src=twsrc%5Etfw">#tweetcart</a> <a href="https://twitter.com/hashtag/tweetjam?src=hash&amp;ref_src=twsrc%5Etfw">#tweetjam</a> <a href="https://t.co/3ZgbsSXaG0">pic.twitter.com/3ZgbsSXaG0</a></p>&mdash; zep.p8 (@lexaloffle) <a href="https://twitter.com/lexaloffle/status/1052502760329961473?ref_src=twsrc%5Etfw">October 17, 2018</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Gardner&#39;s sky texture. Source in next message and also in Computer graphics principles and practice (2nd edition) / Chapter 20.8.2 Clouds and atmosphere<br /><br />BTW It took me about an hour to realize I had some extra spaces in the code!<a href="https://twitter.com/hashtag/pico8?src=hash&amp;ref_src=twsrc%5Etfw">#pico8</a> <a href="https://twitter.com/hashtag/tweetcart?src=hash&amp;ref_src=twsrc%5Etfw">#tweetcart</a> <a href="https://twitter.com/hashtag/tweetjam?src=hash&amp;ref_src=twsrc%5Etfw">#tweetjam</a> <a href="https://twitter.com/hashtag/screenshotsunday?src=hash&amp;ref_src=twsrc%5Etfw">#screenshotsunday</a> <a href="https://t.co/qx7XsjumOB">pic.twitter.com/qx7XsjumOB</a></p>&mdash; Michał Rostocki (@von_rostock) <a href="https://twitter.com/von_rostock/status/1114960242171949058?ref_src=twsrc%5Etfw">April 7, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>You can find more on <a href="https://twitter.com/hashtag/tweetcart?src=hash">Twitter by #tweetcart</a> or at <a href="https://museum-of-tweetcart-history.neocities.org">Museum of Tweetcart History</a>.</p>

<hr />

<h2 id="creating-classic-demoscene-effects-on-pico-8">Creating classic demoscene effects on PICO-8</h2>

<p>If you don’t know what demoscene is, read <a href="/2018/08/05/creativity-through-limitation-8-bit-demoscene.html">the first article in this series</a>. Many classic effects are recurring in different demos, and I’m going to re-create two of them on PICO-8: Vertical raster bars and Rotozoomer. PICO-8 uses the Lua programming language. If you‘re not familiar with it, it shouldn‘t be a problem, because Lua syntax is simple and straightforward.</p>

<iframe class="frame" src="/demos/raster-rotozoomer/raster_rotozoomer.html"></iframe>
<p class="footnote">PICO-8 can run in a browser. Try it!</p>

<h3 id="vertical-raster-bars">Vertical raster bars</h3>

<p>Let’s start with Vertical raster bars (also known as Kefrens bars, even though the first implementation was done not by Kefrens demo group). They look impressive on old computers because you could think — wow, they draw so many vertical lines! In reality, this effect doesn’t require drawing vertical lines at all. The classic implementation utilized Amiga’s ability to run some code for every scanline and change video memory address. You create a buffer for just one line and draw it repeatedly, adding a small “bar” every time in a different position.</p>

<p>You can use the same approach on PICO-8. There are no horizontal blank interrupts, but you don’t need it; instead, you use <code class="highlighter-rouge">memcpy</code> function. Let’s create a template first.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- PICO-8 init function, create a coroutine here</span>
<span class="k">function</span> <span class="nf">_init</span><span class="p">()</span>
  <span class="n">cfx</span> <span class="o">=</span> <span class="n">cocreate</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- The effect can run in 60 FPS, use _update60() instead of _update()</span>
<span class="k">function</span> <span class="nf">_update60</span><span class="p">()</span>
<span class="k">end</span>

<span class="c1">-- PICO-8 frame draw function</span>
<span class="k">function</span> <span class="nf">_draw</span><span class="p">()</span>
  <span class="c1">-- Draw the frame</span>
  <span class="n">coresume</span><span class="p">(</span><span class="n">cfx</span><span class="p">)</span>
  <span class="c1">-- Uncomment the following lines to see CPU load</span>
  <span class="c1">--cursor(0, 0)</span>
  <span class="c1">--color(15)</span>
  <span class="c1">--print(stat(1))</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">fx</span><span class="p">()</span>
  <span class="c1">-- FX code will be here</span>
<span class="k">end</span>
</code></pre></div></div>

<p>I like to use coroutines for both drawing and updating state variables because they allow me to write code linearly and encapsulate all variables in a function. The downside of this approach is the slowdown if your drawing code occasionally takes more than one frame to complete. When you use <code class="highlighter-rouge">_update()</code> + <code class="highlighter-rouge">_draw()</code> approach, you only get frame rate drop, because PICO-8 always executes <code class="highlighter-rouge">_update()/_update60()</code> at the constant rate (30/60 times per second), but may call <code class="highlighter-rouge">_draw()</code> at the lower rate (30/15 times per second).</p>

<p>So, here’s the code with comments:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Raster bars</span>
<span class="k">function</span> <span class="nf">fx</span><span class="p">()</span>
  <span class="c1">-- Raster bars variables: phase counters</span>
  <span class="kd">local</span> <span class="n">ph1</span><span class="p">,</span> <span class="n">ph2</span><span class="p">,</span> <span class="n">ph3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="kd">local</span> <span class="n">pht1</span><span class="p">,</span> <span class="n">pht2</span><span class="p">,</span> <span class="n">pht3</span><span class="p">,</span> <span class="n">x</span>

  <span class="k">while</span> <span class="kc">true</span> <span class="k">do</span>
    <span class="c1">-- Clear the line buffer. I use the last line of the screen</span>
    <span class="c1">-- for it to use PSET function to draw.</span>
    <span class="n">memset</span><span class="p">(</span><span class="mh">0x7fc0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>
    <span class="c1">-- Set temporary variables</span>
    <span class="n">pht1</span><span class="p">,</span> <span class="n">pht2</span><span class="p">,</span> <span class="n">pht3</span> <span class="o">=</span> <span class="n">ph1</span><span class="p">,</span> <span class="n">ph2</span><span class="p">,</span> <span class="n">ph3</span>

    <span class="c1">-- Loop over all 128 screen lines</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">127</span> <span class="k">do</span>
      <span class="c1">-- Vertical raster bars</span>
      <span class="c1">-- 1. Calculate the position for the next bar piece</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">flr</span><span class="p">(</span><span class="mi">63</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">19</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
      <span class="c1">-- 2. Draw the bar by plotting points around the calculated X position</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="c1">-- 3. Update temporary phase variables for the next line</span>
      <span class="n">pht1</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">01</span>
      <span class="n">pht2</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">02</span>
      <span class="n">pht3</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">04</span>

      <span class="c1">-- Copy the line buffer</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="mh">0x6000</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="mh">0x7fc0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1">-- Update phase counters</span>
    <span class="n">ph1</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002</span>
    <span class="n">ph2</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">004</span>
    <span class="n">ph3</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">03</span>

    <span class="c1">-- We're done, wait for the next frame</span>
    <span class="n">yield</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now let’s add a roto-zoomer. I tried implementing a full-screen roto-zoomer on PICO-8 in 60 FPS and ran out of CPU time. However, if you combine a roto-zoomer with raster-bars, you don’t need to do it full-screen — You can draw in empty space only! It’s easy to track empty space with raster bars: the bar gets only wider every line, it can’t get narrower, so you can keep simply track the lowest and the highest X coordinates.</p>

<p>Roto-zoomer usually is a rotating and zooming picture, but I don’t want to deal with images in this example and will create a rotating and zooming checkerboard. Here’s the code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Raster bars + roto-zoomer</span>
<span class="k">function</span> <span class="nf">fx</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">ph1</span><span class="p">,</span> <span class="n">ph2</span><span class="p">,</span> <span class="n">ph3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="kd">local</span> <span class="n">pht1</span><span class="p">,</span> <span class="n">pht2</span><span class="p">,</span> <span class="n">pht3</span><span class="p">,</span> <span class="n">x</span>
  <span class="c1">-- Roto-zoomer variables: rotation angle; zoom, X and Y phases</span>
  <span class="kd">local</span> <span class="n">zph</span><span class="p">,</span> <span class="n">zzoom</span><span class="p">,</span> <span class="n">zpx</span><span class="p">,</span> <span class="n">zpy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="c1">-- Temporary variables</span>
  <span class="kd">local</span> <span class="n">xr</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">ztx</span><span class="p">,</span> <span class="n">zty</span><span class="p">,</span> <span class="n">zdx</span><span class="p">,</span> <span class="n">zdy</span><span class="p">,</span> <span class="n">zsx</span><span class="p">,</span> <span class="n">zsy</span>

  <span class="k">while</span> <span class="kc">true</span> <span class="k">do</span>
    <span class="n">memset</span><span class="p">(</span><span class="mh">0x7fc0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>
    <span class="n">pht1</span><span class="p">,</span> <span class="n">pht2</span><span class="p">,</span> <span class="n">pht3</span> <span class="o">=</span> <span class="n">ph1</span><span class="p">,</span> <span class="n">ph2</span><span class="p">,</span> <span class="n">ph3</span>
    <span class="c1">-- Set roto-zoomer temporary variables</span>
    <span class="n">lx</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">hx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">-- zdx, zdy — rotated and scaled step vector</span>
    <span class="n">zdx</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">zph</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">zzoom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">zdy</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">zph</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">zzoom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1">-- zsx, zsy — position on the checkerboard</span>
    <span class="n">zsx</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">zpx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span>
    <span class="n">zsy</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">zpy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">127</span> <span class="k">do</span>
      <span class="c1">-- Vertical raster bars</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">flr</span><span class="p">(</span><span class="mi">63</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">19</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">pht3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
      <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="n">pht1</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">01</span>
      <span class="n">pht2</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">02</span>
      <span class="n">pht3</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">04</span>

      <span class="c1">-- Roto-zoomer</span>
      <span class="c1">-- 1. Update left and right boundaries</span>
      <span class="n">xr</span> <span class="o">=</span> <span class="n">flr</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xr</span> <span class="o">&lt;</span> <span class="n">lx</span><span class="p">)</span> <span class="n">lx</span> <span class="o">=</span> <span class="n">xr</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xr</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">hx</span><span class="p">)</span> <span class="n">hx</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="c1">-- 2. Coordinates at the beginning of the line</span>
      <span class="n">ztx</span> <span class="o">=</span> <span class="n">zsx</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">zdy</span>
      <span class="n">zty</span> <span class="o">=</span> <span class="n">zsy</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">zdx</span>
      <span class="c1">-- 3. Draw left part</span>
      <span class="k">for</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lx</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">poke</span><span class="p">(</span><span class="mh">0x7fc0</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">band</span><span class="p">(</span><span class="n">bxor</span><span class="p">(</span><span class="n">zty</span><span class="p">,</span> <span class="n">ztx</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">and</span> <span class="mh">0xaa</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ztx</span> <span class="o">+=</span> <span class="n">zdx</span>
        <span class="n">zty</span> <span class="o">-=</span> <span class="n">zdy</span>
      <span class="k">end</span>
      <span class="c1">-- 4. Update coordinates to skip drawn raster bar</span>
      <span class="n">ztx</span> <span class="o">+=</span> <span class="n">zdx</span> <span class="o">*</span> <span class="p">(</span><span class="n">hx</span> <span class="o">-</span> <span class="n">lx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">zty</span> <span class="o">-=</span> <span class="n">zdy</span> <span class="o">*</span> <span class="p">(</span><span class="n">hx</span> <span class="o">-</span> <span class="n">lx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="c1">-- 5. Draw right part</span>
      <span class="k">for</span> <span class="n">c</span> <span class="o">=</span> <span class="n">hx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">63</span> <span class="k">do</span>
        <span class="n">poke</span><span class="p">(</span><span class="mh">0x7fc0</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">band</span><span class="p">(</span><span class="n">bxor</span><span class="p">(</span><span class="n">zty</span><span class="p">,</span> <span class="n">ztx</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">and</span> <span class="mh">0xaa</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ztx</span> <span class="o">+=</span> <span class="n">zdx</span>
        <span class="n">zty</span> <span class="o">-=</span> <span class="n">zdy</span>
      <span class="k">end</span>
      <span class="c1">-- 6. Clean some artifacts</span>
      <span class="k">if</span> <span class="n">pget</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">then</span> <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">end</span>
      <span class="k">if</span> <span class="n">pget</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">then</span> <span class="n">pset</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">end</span>

      <span class="c1">-- Copy line</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="mh">0x6000</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="mh">0x7fc0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1">-- Update raster bars variables</span>
    <span class="n">ph1</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002</span>
    <span class="n">ph2</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">004</span>
    <span class="n">ph3</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">03</span>

    <span class="c1">-- Update roto-zoomer variables</span>
    <span class="n">zph</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>
    <span class="n">zpx</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002</span>
    <span class="n">zpy</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">003</span>
    <span class="n">zzoom</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>

    <span class="n">yield</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><img src="/assets/blog-images/2019-06-18-rotozoomer.png" alt="" /></p>
<p class="footnote">Explanation of the main variables.</p>

<p>Instead of using texture look-up, I use bitwise operations to create checkerboard. <code class="highlighter-rouge">band(ztx, 8)</code> gives a series of 0’s and 8’s every 8 pixels, <code class="highlighter-rouge">bxor(zty, ztx)</code> creates a checkerboard. To speed up the code and make both effects run in 60 FPS, I reduce the horizontal resolution and plot 2 points with a single <code class="highlighter-rouge">poke</code> (write a byte to memory) function instead of <code class="highlighter-rouge">pset</code>.</p>

<p>That’s it! You can find the full code and some other effect I create in <a href="https://github.com/Megus/pico-8-experiments">my PICO-8 repository on GitHub</a>.</p>

<hr />

<p>As I recall, it’s the first time I’ve tried to explain a demo effect, and I’m afraid that it may not be clear enough. I tried to add as many comments as possible, but if you’ve got any questions, let me know, I’m ready to improve and add more details. Thanks for your attention!</p>

  </div>

  <a class="u-url" href="/2019/06/18/creativity-through-limitation-pico-8.html" hidden></a>

</article>

<div class="social-buttons">
  <a class="twitter-share-button" data-size="large"
    href="https://twitter.com/intent/tweet?text=Creativity%20through%20limitation:%20PICO-8%20%E2%80%94%20Fantasy%20Console&via=sugem">
    Tweet
  </a>
  <div class="fb-share-button" style="top: -7px;"
    data-href="https://megus.org/2019/06/18/creativity-through-limitation-pico-8.html"
    data-layout="button" data-size="large">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a>
  </div>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        © Roman “Megus” Petrov.<br />
        <a class="u-email" href="mailto:roman.petrov@icloud.com">roman.petrov@icloud.com</a>
      </div>
      <div class="footer-col">
        <a href="https://twitter.com/sugem"><svg viewbox="0 0 16 16" class="social-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a>
        <a href="https://www.facebook.com/sugem"><svg viewbox="0 0 16 16" class="social-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg></a>
        <a href="https://github.com/Megus"><svg viewbox="0 0 16 16" class="social-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a>
        <a href="https://www.youtube.com/user/megussugem"><svg viewbox="0 0 16 16" class="social-icon"><use xlink:href="/assets/minima-social-icons.svg#youtube"></use></svg></a>    
        <a href="https://medium.com/@megus"><svg viewbox="0 0 16 16" class="social-icon"><use xlink:href="/assets/minima-social-icons.svg#medium"></use></svg></a>
      </div>
    </div>
  </div>

</footer>
</body>
</html>
